{% extends '::base.html.twig' %}

{% form_theme form 'ClientBundle::fields.html.twig' %}

{% block javascripts %}
    <script type="text/javascript">
        $(document).ready(function() {
            $(document).on('click', '.collection-add', function(e) {
                e.preventDefault();
                var list = $(this).parent();
                var newWidget = list.attr('data-prototype');
                var re = new RegExp(list.data('prototype-name'), 'g');
                newWidget = newWidget.replace(re, list.children().length);
                var $newWidget = $(newWidget)/*.first()*/;
                $newWidget.insertBefore($(this));
                addFormDeleteLink($newWidget, list.data('remove-label'));
            });
            $(document).on('change', '.parameter-type', function() {
                var $form = $(this).closest('form');
                var data = {};
                var $that = $(this);
                var $checkedRadio = $(this).find('input[type=radio]:checked');
                data[$checkedRadio.attr('name')] = $checkedRadio.val();
                $.ajax({
                    url : $form.attr('action'),
                    type: $form.attr('method'),
                    data : data,
                    success: function(html) {
                        $that.closest('.step-parameter').replaceWith(
                            $(html).find('#' + $that.attr('id')).closest('.step-parameter')
                        );
                    }
                });
            });
            $('.collection').children().each(function(id, element, label) {
                if (!$(element).hasClass('collection-add')) {
                    addFormDeleteLink($(element), $(this).parent().data('remove-label'));
                }
            });
        });
        function addFormDeleteLink($element, label) {
            var $removeFormA = $('<a href="#" class="btn btn-danger"><span class="glyphicon glyphicon-minus" aria-hidden="true"></span> ' + label + '</a>');
            if ($element.html()) {
                $element.append($removeFormA);
            } else {
                $removeFormA.insertAfter($element);
            }
            $removeFormA.on('click', function (e) {
                e.preventDefault();
                $element.remove();
                $(this).remove();
            });
        }
    </script>
{% endblock %}
